import{s as l}from"./supabase-C7oNB1te.js";import{A as s}from"./auth-BlDcbQa-.js";import{B as n}from"./blog-CY9cUIuU.js";class c{static async uploadImage(t,e="gallery"){try{const r=t.name.split(".").pop(),i=`${Date.now()}.${r}`,d=`${e}/${i}`,{data:p,error:u}=await l.storage.from("images").upload(d,t);if(u)throw u;const{data:{publicUrl:y}}=l.storage.from("images").getPublicUrl(d);return{success:!0,url:y,path:d}}catch(r){return{success:!1,error:r.message}}}static async addGalleryImage(t){try{const{data:e,error:r}=await l.from("gallery_images").insert([{...t,created_at:new Date().toISOString()}]).select().single();if(r)throw r;return{success:!0,data:e}}catch(e){return{success:!1,error:e.message}}}static async getGalleryImages(){try{const{data:t,error:e}=await l.from("gallery_images").select("*").order("created_at",{ascending:!1});if(e)throw e;return{success:!0,data:t}}catch(t){return{success:!1,error:t.message}}}static async deleteGalleryImage(t){try{const{data:e}=await l.from("gallery_images").select("image_path").eq("id",t).single();e?.image_path&&await l.storage.from("images").remove([e.image_path]);const{error:r}=await l.from("gallery_images").delete().eq("id",t);if(r)throw r;return{success:!0}}catch(e){return{success:!1,error:e.message}}}}window.addEventListener("load",async()=>{const a=await s.getCurrentUser();if(!a){s.redirectToLogin();return}if(!await s.checkAdminRole(a.id)){s.redirectToLogin();return}document.getElementById("userEmail").textContent=a.email,o(),m(),g()});document.getElementById("logoutBtn").addEventListener("click",async()=>{await s.logout(),s.redirectToLogin()});document.querySelectorAll(".tab-button").forEach(a=>{a.addEventListener("click",()=>{const t=a.dataset.tab;document.querySelectorAll(".tab-button").forEach(e=>e.classList.remove("active")),a.classList.add("active"),document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active")),document.getElementById(t).classList.add("active")})});document.getElementById("newArticleBtn").addEventListener("click",()=>{document.getElementById("articleForm").classList.remove("hidden"),document.getElementById("formTitle").textContent="ARTIKEL BARU",document.getElementById("articleFormElement").reset(),document.getElementById("articleId").value=""});document.getElementById("cancelArticle").addEventListener("click",()=>{document.getElementById("articleForm").classList.add("hidden")});document.getElementById("articleFormElement").addEventListener("submit",async a=>{a.preventDefault();const t={title:document.getElementById("articleTitle").value,excerpt:document.getElementById("articleExcerpt").value,content:document.getElementById("articleContent").value,featured_image:document.getElementById("articleImage").value,published:document.getElementById("articlePublished").checked},e=document.getElementById("articleId").value;let r;e?r=await n.updateArticle(e,t):r=await n.createArticle(t),r.success?(document.getElementById("articleForm").classList.add("hidden"),o()):alert("Error: "+r.error)});document.getElementById("uploadImageBtn").addEventListener("click",()=>{document.getElementById("uploadForm").classList.remove("hidden")});document.getElementById("cancelUpload").addEventListener("click",()=>{document.getElementById("uploadForm").classList.add("hidden")});document.getElementById("uploadFormElement").addEventListener("submit",async a=>{a.preventDefault();const t=document.getElementById("imageFile").files[0];if(!t)return;const e=await c.uploadImage(t);if(!e.success){alert("Error uploading image: "+e.error);return}const r={name:document.getElementById("imageName").value,description:document.getElementById("imageDescription").value,image_url:e.url,image_path:e.path},i=await c.addGalleryImage(r);i.success?(document.getElementById("uploadForm").classList.add("hidden"),document.getElementById("uploadFormElement").reset(),m()):alert("Error: "+i.error)});async function o(){const a=await n.getAllArticlesForAdmin();if(a.success){const t=document.getElementById("articlesList");t.innerHTML=a.data.map(e=>`
                    <div class="border border-red-700 p-4 flex justify-between items-center">
                        <div>
                            <h3 class="font-bold">${e.title}</h3>
                            <p class="text-sm text-gray-400">${e.excerpt}</p>
                            <p class="text-xs text-amber-200">
                                ${e.published?"Terbit":"Draft"} â€¢ 
                                ${new Date(e.created_at).toLocaleDateString("id-ID")}
                            </p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editArticle('${e.id}')" class="px-3 py-1 bg-blue-700 text-white text-sm">
                                Edit
                            </button>
                            <button onclick="deleteArticle('${e.id}')" class="px-3 py-1 bg-red-700 text-white text-sm">
                                Hapus
                            </button>
                        </div>
                    </div>
                `).join("")}}async function m(){const a=await c.getGalleryImages();if(a.success){const t=document.getElementById("galleryGrid");t.innerHTML=a.data.map(e=>`
                    <div class="relative group">
                        <img src="${e.image_url}" alt="${e.name}" class="w-full h-48 object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                            <button onclick="deleteGalleryImage('${e.id}')" class="px-3 py-1 bg-red-700 text-white text-sm">
                                Hapus
                            </button>
                        </div>
                        <div class="p-2 bg-gray-900">
                            <p class="text-sm font-bold">${e.name}</p>
                            <p class="text-xs text-gray-400">${e.description||""}</p>
                        </div>
                    </div>
                `).join("")}}async function g(){const a=await n.getAllArticlesForAdmin(),t=await c.getGalleryImages();a.success&&(document.getElementById("totalArticles").textContent=a.data.length,document.getElementById("publishedArticles").textContent=a.data.filter(e=>e.published).length),t.success&&(document.getElementById("totalImages").textContent=t.data.length)}window.editArticle=async a=>{const t=await n.getAllArticlesForAdmin();if(t.success){const e=t.data.find(r=>r.id===a);e&&(document.getElementById("articleId").value=e.id,document.getElementById("articleTitle").value=e.title,document.getElementById("articleExcerpt").value=e.excerpt,document.getElementById("articleContent").value=e.content,document.getElementById("articleImage").value=e.featured_image||"",document.getElementById("articlePublished").checked=e.published,document.getElementById("formTitle").textContent="EDIT ARTIKEL",document.getElementById("articleForm").classList.remove("hidden"))}};window.deleteArticle=async a=>{if(confirm("Yakin ingin menghapus artikel ini?")){const t=await n.deleteArticle(a);t.success?o():alert("Error: "+t.error)}};window.deleteGalleryImage=async a=>{if(confirm("Yakin ingin menghapus gambar ini?")){const t=await c.deleteGalleryImage(a);t.success?(m(),g()):alert("Error: "+t.error)}};
